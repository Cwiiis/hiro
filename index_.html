<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>MozVR</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/hiro.css">
    <link rel="stylesheet" href="css/instructions.css">
    <link rel='stylesheet' href='fonts/montserrat/montserrat.css' type='text/css'>
  </head>
  <body>
    <!-- this is a containing element that will be made fullscreen -->
    <div id="container">
      <!-- This is the container which external iframe content is loaded into. -->
      <div id="loader" class="fit"></div>

      <!-- This is the container in which all the UI elements load into -->
      <div id="ui" class="fit"></div>
    </div><!-- #container -->

    <div id="content" class="fit">
      <div id="intro">
        <span>Weâ€™re the Mozilla Research VR team.</span><br>
        <span>This is our open lab, where we</span><br>
        <span>share experiments and code.</span><br>
      </div>

      <div id="entervr" class="center">
        <div id="launch" class="button-large">Enter VR</div>
      </div>

      <div id="vrDownload" class="center is-hidden" >
        <em>mozvr.com is a virtual reality website.</em><br/>
        To get the VR eperience, you need a VR-enabled browser, like our experimental builds of Firefox and a VR headset, like Oculus Rift.

        <br/><br/>

        <a href="downloads.html"><button class="button-wire">Get Firefox VR</button></a>
      </div>


      <div id="navigation">
        <div id="logo" class="float-left">mozvr.com</div>

        <div id="links" class="float-left">
          <ul class="flat-list group">
            <li>
              <a href="content/2014/11/10/mozvr-launches.html" target="_blank">About</a>
            </li>
            <li>
              <a href="downloads.html" target="_blank">Downloads</a>
            </li>
            <li>
              <a href="readme.html" target="_blank">Read Me</a>
            </li>
            <li>
              <a href="https://github.com/MozVR" target="_blank">GitHub</a>
            </li>
          </ul>
        </div>

        <div id="modes" class="float-right">
          <div class="status animate-in-out is-hidden" id="vrEnabled">
            VR Browser detected
          </div>
        </div><!-- #mode -->

      </div><!-- #navigation -->

    </div><!-- #content -->

    <div id="fsPrompt" class="center is-hidden">
      <div class="arrow-up"></div>

      <h2>Allow Fullscreen:</h2>
      <h3 class="lightgray">Don't forget to <u>check remember</u>!</h3>

      <br/><br/>

      <div class="delayed-animate-in center">
        <div id="fsContinue" class="button-large white">ESC</div>

        <span class='gamma'>TO CONTINUE</span>
      </div>

      <br/><br/>

      <p class="lightgray">(You will only have to do this once.)</p>

    </div>

  </body>
  <script src="js/vendor/three.min.js"></script>
  <script src="js/vendor/VRControls.js"></script>
  <script src="js/vendor/DeviceOrientationControls.js"></script>
  <script src="js/vendor/VREffect.js"></script>
  <script src="js/vendor/StereoEffect.js"></script>
  <script src="js/vendor/tween.min.js"></script>
  <script src="js/lib/dom2three.js"></script>
  <script src="js/vrutils.js"></script>
  <script src="js/vrtab.js"></script>
  <script src="js/vrtransition.js"></script>
  <script src="js/vrsound.js"></script>
  <script src="js/vrcursor.js"></script>
  <script src="js/vrhud.js"></script>
  <script src="js/vrtitle.js"></script>
  <script src="js/vrloading.js"></script>
  <script src="js/vrui.js"></script>
  <script src="js/vrmanager.js"></script>

  <script>
    window.DomUi = (function() {
      function DomUi() {
        /*
        fullscreen and pointerlock permissions show up on the rift display
        making them inacessible rendering the site unsusable by the user.
        Because of this, we will need to request fullscreen and pointer lock
        permissions on the main desktop before the user enters the experience.
        */
        var fsPointerscreen = document.querySelector('#fsPrompt');

        var fsContinueButton = document.querySelector('#fsContinue');

        var enterVRButton = document.querySelector('#launch');

        function fullscreenPrompt() {
          var fs = document.body;

          fsPointerscreen.classList.remove('is-hidden');

          if (fs.requestFullscreen) {
            fs.requestFullscreen();
          } else if (fs.mozRequestFullScreen) {
            fs.mozRequestFullScreen();
          } else if (fs.webkitRequestFullscreen) {
            fs.webkitRequestFullscreen();
          }

          var bodyEl = document.body;
          bodyEl.requestPointerLock = bodyEl.requestPointerLock ||
            bodyEl.mozRequestPointerLock ||
            bodyEl.webkitRequestPointerLock;

          bodyEl.requestPointerLock();
        };


        // listen for fullscreen change events so we can hide the fs prompt.
        document.addEventListener('mozfullscreenchange', onFschange);
        document.addEventListener('webkitfullscreenchange', onFschange);
        document.addEventListener('fullscreenchange', onFschange);

        function onFschange() {
          var fullscreenElement = document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement;
          var fs = fsPointerscreen;

          if (!fullscreenElement) {
            fs.classList.add('is-hidden');
            enterVRButton.classList.remove('is-hidden');
          }
        };


        // enter VR button
        function promptPermission() {

          if (document.cookie == 'fsPrompted=true') {
            // we've prompted the user before for fullscreen permissions.  let's go!
            VRManager.enableVR();
          } else {
            document.cookie = "fsPrompted=true; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/";
            fullscreenPrompt();
            enterVRButton.classList.add('is-hidden');
          }
        };



        enterVRButton.addEventListener('click', function() {
          promptPermission();
        })







        /*
        detect wether or not we have a VR compatible browser.   If
        they have a VR browser, just show a status that we have detected one.

        Otherwise, display a dialogue prompt to download
        */

        // elements
        var downloadDialogue = document.querySelector('#vrDownload');

        var statusDialogue = document.querySelector('#vrEnabled');

        VRManager.vrReady.then(function() {
          // VR detected

          // hide entervr button
          enterVRButton.classList.remove('is-hidden');

          // hide download dialogue
          downloadDialogue.classList.add('is-hidden');
          statusDialogue.classList.remove('is-hidden');
        }, function() {
          // VR NOT detected

          // add entervr button
          enterVRButton.classList.add('is-hidden');

          // show download dialogue
          statusDialogue.classList.add('is-hidden');

          // download button
          downloadDialogue.classList.remove('is-hidden');
        });

      }

      return new DomUi();
    })();
  </script>
</html>
